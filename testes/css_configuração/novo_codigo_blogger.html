<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lista de PokÃ©mon Unificada</title>
    <style>
    /* Estilos do cÃ³digo anterior mantidos para a exibiÃ§Ã£o dos cards */
    .pokemon-image-container {
        position: relative;
        display: inline-block;
    }

    .pokemon-image-container .imgSelvagem,
    .pokemon-image-container .pokemon-reide-img,
    .pokemon-image-container .img-detalhes {
        position: relative;
        z-index: 2;
        display: block;
        max-width: 120px; /* Ajuste para melhor visualizaÃ§Ã£o */
        height: auto;
        margin: 0 auto;
    }

    .pokemon-image-container.is-shadow::before {
        content: '';
        position: absolute;
        top: -10px;
        left: -10px;
        width: calc(100% + 20px);
        height: calc(100% + 20px);
        background-image: url('https://raw.githubusercontent.com/nowadraco/blogger-poke-dragon-shadow/refs/heads/main/img/assets/shadow.png');
        background-size: contain;
        background-repeat: no-repeat;
        background-position: center;
        z-index: 1;
        animation: flickerFire 3s ease-in-out infinite;
    }

    .pokemon-image-container.is-dynamax > img {
        filter: drop-shadow(0 0 10px rgba(255, 20, 50, 0.9)) drop-shadow(0 0 25px rgba(255, 20, 50, 0.7));
        animation: pulseRed 2s ease-in-out infinite;
    }

    .pokemon-image-container.is-dynamax::before {
        content: '';
        position: absolute;
        width: 120%;
        height: 50px;
        left: 50%;
        transform: translateX(-50%);
        background-image: url('https://raw.githubusercontent.com/nowadraco/blogger-poke-dragon-shadow/refs/heads/main/img/assets/dynamax-clouds-v2.webp');
        background-size: contain;
        background-position: center;
        background-repeat: no-repeat;
        z-index: 3;
        animation: moveClouds 5s ease-in-out infinite;
        top: 35px;
    }

    ul.selvagens, ul.reide-list, ul.lista-detalhes {
        list-style-type: none;
        padding: 0;
        display: flex;
        flex-wrap: wrap;
        justify-content: space-around;
    }

    li.Selvagem, li.PokemonReideItem, li.ItemDetalhes {
        border: 2px solid #ccc;
        border-radius: 10px;
        padding: 10px;
        margin: 10px;
        text-align: center;
        transition: transform 0.2s;
        display: flex;
        flex-direction: column;
        font-size: 16px;
        font-weight: bold;
        color: #fff;
        text-shadow: 1px 1px 2px black;
    }
     li.Selvagem, li.PokemonReideItem { width: 150px; }
     li.ItemDetalhes { width: 170px; }

    li.Selvagem:hover, li.PokemonReideItem:hover, li.ItemDetalhes:hover {
        transform: scale(1.05);
    }
    
    .boost, .tipo-icons { display: flex; align-items: center; justify-content: center; gap: 5px; margin-top: 5px; }
    .tipo-icons img { width: 20px; }
    .clima-boost { width: 26px; }
    .pc-boost { font-size: 14px; }
    
    .detalhes-weakness-section { margin-top: 10px; padding-top: 8px; border-top: 1px solid rgba(255, 255, 255, 0.4); }
    .detalhes-weakness-section h4 { margin: 0 0 5px; font-size: 14px; }
    .detalhes-weakness-list { list-style: none; padding: 0; margin: 0; display: flex; flex-direction: column; gap: 4px; }
    .detalhes-weakness-item { display: flex; justify-content: space-between; align-items: center; background-color: rgba(0, 0, 0, 0.2); border-radius: 5px; padding: 2px 5px; }
    .detalhes-weakness-type { display: flex; align-items: center; gap: 5px; }
    .detalhes-weakness-type img { width: 18px; height: 18px; }
    .detalhes-weakness-type span { font-size: 16px; font-weight: normal; }
    .detalhes-weakness-percentage { font-size: 12px; }

    @keyframes flickerFire { 0%{transform:scale(1) translateY(0) skewX(0);opacity:.8} 20%{transform:scale(1.05) translateY(-5px) skewX(-2deg);opacity:1} 40%{transform:scale(.98) translateY(2px) skewX(2deg);opacity:.75} 60%{transform:scale(1.03) translateY(-3px) skewX(-1deg);opacity:.9} 80%{transform:scale(1) translateY(1px) skewX(1deg);opacity:.8} 100%{transform:scale(1) translateY(0) skewX(0);opacity:.8} }
    @keyframes pulseRed { 0%{filter:drop-shadow(0 0 10px rgba(255,20,50,.9)) drop-shadow(0 0 25px rgba(255,20,50,.7))} 50%{filter:drop-shadow(0 0 15px rgba(255,80,100,1)) drop-shadow(0 0 35px rgba(255,80,100,.7))} 100%{filter:drop-shadow(0 0 10px rgba(255,20,50,.9)) drop-shadow(0 0 25px rgba(255,20,50,.7))} }
    @keyframes moveClouds { 0%{transform:translate(-50%,0)} 50%{transform:translate(-50%,-5px)} 100%{transform:translate(-50%,0)} }
    </style>
</head>

<body>
    <h4>Reides de uma estrela</h4>
    <ul class="lista-detalhes">
        <li>Shellder*</li>
        <li>Ducklett*</li>
        <li>Tatsugiri (Forma Curvada)</li>
        <li>Tatsugiri (Forma Pendular)</li>
        <li>Tatsugiri (Forma Estendida)</li>
        <li>Terrakion</li>
    </ul>
    <h4>Reides</h4>
    <ul class="lista-detalhes">
        <li>Meganium (shadow)*</li>
        <li>Cyndaquil (shadow)</li>
        <li>Murkrow (shadow)*</li>
        <li>Spoink (shadow)</li>
        <li>Geodude de Alola</li>
    </ul>
    <ul class="lista-detalhes">
        <li>Magnemite Dinamax</li>
        <li>Cyndaquil Dinamax</li>
        <li>Murkrow Dinamax*</li>
        <li>Spoink Dinamax*</li>
    </ul>
    <h4>Reides de trÃªs estrelas</h4>
    <ul class="reide-list">
        <li>Meganium</li>
        <li>Hippowdon*</li>
        <li>Samurott</li>
    </ul>
    <h4>shadow</h4>
    <ul class="reide-list">
        <li>Meganium (shadow)*</li>
        <li>Cyndaquil (shadow)</li>
        <li>Murkrow (shadow)*</li>
        <li>Spoink (shadow)</li>
    </ul>
    <ul class="reide-list">
        <li>Magnemite Dinamax</li>
        <li>Cyndaquil Dinamax</li>
        <li>Murkrow Dinamax*</li>
        <li>Spoink Dinamax*</li>
    </ul>
    <h4>Selvagens</h4>
    <ul class="selvagens pokemon-list">
        <li>Bulbasaur*</li>
        <li>Machop*</li>
        <li>Chansey*</li>
        <li>Raikou*</li>
        <li>Suicune*</li>
        <li>Entei*</li>
        <li>Wailmer*</li>
        <li>Darumaka*</li>
        <li>Passimian*</li>
        <li>Grookey</li>
        <li>Skwovet*</li>
        <li>Wooloo*</li>
        <li>Salandit*</li>
        <li>Geodude de Alola*</li>
    </ul>
    <ul class="selvagens pokemon-list">
        <li>Bulbasaur*</li>
        <li>Salandit (shadow)*</li>
    </ul>
    <h4>Megas</h4>
    <ul class="selvagens pokemon-list">
        <li>Mega Venusaur*</li>
        <li>Mega Venusaur</li>
    </ul>

    <script>
    // =============================================================
    //   SCRIPT POKÃ‰MON UNIFICADO (MODELO DE DADOS HÃBRIDO)
    // =============================================================
    
    // --- 1. CONSTANTES E DADOS GLOBAIS ---
    const URLS = {
        MAIN_DATA: 'https://raw.githubusercontent.com/nowadraco/blogger-poke-dragon-shadow/refs/heads/main/testes/poke_data.json',
        MAIN_DATA_FALLBACK: 'https://raw.githubusercontent.com/nowadraco/blogger-poke-dragon-shadow/bd94d4e25098582c2d31e520a55e2cee3eedf300/testes/poke_data.json',
        IMAGES_PRIMARY: 'https://raw.githubusercontent.com/nowadraco/blogger-poke-dragon-shadow/refs/heads/main/testes/imagens_pokemon.json',
        IMAGES_ALT: 'https://raw.githubusercontent.com/nowadraco/blogger-poke-dragon-shadow/refs/heads/main/testes/imagens_pokemon_alt.json',
        TYPE_DATA: 'https://raw.githubusercontent.com/nowadraco/bloggerpoke/main/src/data/gamemaster/tipos_poke.json'
    };
    const cpms = [0.0939999967813491,0.135137430784308,0.166397869586944,0.192650914456886,0.215732470154762,0.236572655026622,0.255720049142837,0.273530381100769,0.29024988412857,0.306057381335773,0.321087598800659,0.335445032295077,0.349212676286697,0.36245774877879,0.375235587358474,0.387592411085168,0.399567276239395,0.41119354951725,0.422500014305114,0.432926413410414,0.443107545375824,0.453059953871985,0.46279838681221,0.472336077786704,0.481684952974319,0.490855810259008,0.499858438968658,0.508701756943992,0.517393946647644,0.525942508771329,0.534354329109191,0.542635762230353,0.550792694091796,0.558830599438087,0.566754519939422,0.574569148039264,0.582278907299041,0.589887911977272,0.59740000963211,0.604823657502073,0.61215728521347,0.61940411056605,0.626567125320434,0.633649181622743,0.640652954578399,0.647580963301656,0.654435634613037,0.661219263506722,0.667934000492096,0.674581899290818,0.681164920330047,0.687684905887771,0.694143652915954,0.700542893277978,0.706884205341339,0.713169102333341,0.719399094581604,0.725575616972598,0.731700003147125,0.734741011137376,0.737769484519958,0.740785574597326,0.743789434432983,0.746781208702482,0.749761044979095,0.752729105305821,0.75568550825119,0.758630366519684,0.761563837528228,0.764486065255226,0.767397165298461,0.77029727397159,0.77318650484085,0.776064945942412,0.778932750225067,0.781790064808426,0.784636974334716,0.787473583646825,0.790300011634826,0.792803950958807,0.795300006866455,0.79780392148697,0.800300002098083,0.802803892322847,0.805299997329711,0.807803863460723,0.81029999256134,0.812803834895026,0.815299987792968,0.817803806620319,0.820299983024597,0.822803778631297,0.825299978256225,0.827803750922782,0.830299973487854,0.832803753381377,0.835300028324127,0.837803755931569,0.840300023555755,0.842803729034748,0.845300018787384,0.847803702398935,0.850300014019012,0.852803676019539,0.85530000925064,0.857803649892077,0.860300004482269,0.862803624012168,0.865299999713897];
    const TYPE_TRANSLATION_MAP = { grass:'Planta',poison:'Venenoso',fire:'Fogo',water:'Ãgua',electric:'ElÃ©trico',ice:'Gelo',fighting:'Lutador',ground:'Terrestre',flying:'Voador',psychic:'PsÃ­quico',bug:'Inseto',rock:'Pedra',ghost:'Fantasma',dragon:'DragÃ£o',dark:'Sombrio',steel:'AÃ§o',fairy:'Fada',normal:'Normal' };

    // --- 2. FUNÃ‡Ã•ES UTILITÃRIAS COMPARTILHADAS ---
    
    function getTypeColor(tipo) {
        const typeColors = { normal:'#A8A77A',fogo:'#FF4500',Ã¡gua:'#1E90FF',elÃ©trico:'#F7D02C',planta:'#32CD32',gelo:'#96D9D6',lutador:'#C22E28',venenoso:'#A33EA1',terrestre:'#E2BF65',voador:'#A98FF3',psÃ­quico:'#F95587',inseto:'#A6B91A',pedra:'#B6A136',fantasma:'#735797',dragÃ£o:'#6F35FC',sombrio:'#705746',aÃ§o:'#B7B7CE',fada:'#D685AD',grass:'#32CD32',poison:'#A33EA1',fire:'#FF4500',water:'#1E90FF',electric:'#F7D02C',ice:'#96D9D6',fighting:'#C22E28',ground:'#E2BF65',flying:'#A98FF3',psychic:'#F95587',bug:'#A6B91A',rock:'#B6A136',ghost:'#735797',dragon:'#6F35FC',dark:'#705746',steel:'#B7B7CE',fairy:'#D685AD' };
        return typeColors[tipo.toLowerCase()] || '#FFFFFF';
    }

    function getTypeIcon(tipo) {
        const typeIcons = { aÃ§o:'aco',Ã¡gua:'agua',dragÃ£o:'dragao',elÃ©trico:'eletrico',fada:'fada',fantasma:'fantasma',fogo:'fogo',gelo:'gelo',inseto:'inseto',lutador:'lutador',normal:'normal',pedra:'pedra',planta:'planta',psÃ­quico:'psiquico',sombrio:'sombrio',terrestre:'terrestre',venenoso:'venenoso',voador:'voador',grass:'planta',poison:'venenoso',fire:'fogo',water:'agua',electric:'eletrico',ice:'gelo',fighting:'lutador',ground:'terrestre',flying:'voador',psychic:'psiquico',bug:'inseto',rock:'pedra',ghost:'fantasma',dragon:'dragao',dark:'sombrio',steel:'aco',fairy:'fada'};
        const iconName = typeIcons[tipo.toLowerCase()];
        return iconName ? `https://raw.githubusercontent.com/nowadraco/pokedragonshadow.site/refs/heads/main/src/imagens/tipos/${iconName}.png` : '';
    }
    
    function getWeatherIcon(tipo) {
        const weatherMap = { planta:'ensolarado',fogo:'ensolarado',terrestre:'ensolarado',Ã¡gua:'chovendo',elÃ©trico:'chovendo',inseto:'chovendo',normal:'parcialmente_nublado',pedra:'parcialmente_nublado',fada:'nublado',lutador:'nublado',venenoso:'nublado',voador:'ventando',dragÃ£o:'ventando',psÃ­quico:'ventando',gelo:'nevando',aÃ§o:'nevando',sombrio:'neblina',fantasma:'neblina'};
        const translatedType = TYPE_TRANSLATION_MAP[tipo.toLowerCase()] || tipo;
        const icon = weatherMap[translatedType.toLowerCase()];
        return icon ? `https://raw.githubusercontent.com/nowadraco/pokedragonshadow.site/c3027920e2d9674426a728d292ff8ce08209b2d2/src/imagens/clima/${icon}.png` : '';
    }

    function calculateCP(baseStats, ivs, level) {
        const cpm = cpms[Math.round((level - 1) * 2)];
        return Math.floor(((baseStats.atk + ivs.atk) * Math.sqrt(baseStats.def + ivs.def) * Math.sqrt(baseStats.hp + ivs.hp) * cpm * cpm) / 10);
    }
    
    function formatarNomeParaExibicao(speciesName) {
        if (!speciesName) return '';
        return speciesName
            .replace('Pikachu (5th Anniversary)', 'Pikachu 5th AniversÃ¡rio').replace('Pikachu (Flying)', 'Pikachu Voador')
            .replace('Pikachu (Horizons)', 'Pikachu Horizons').replace('Pikachu (Kariyushi)', 'Pikachu Kariyushi')
            .replace('Pikachu (Libre)', 'Pikachu Libre').replace('Pikachu (Pop Star)', 'Pikachu Pop Star')
            .replace('Pikachu (Rock Star)', 'Pikachu Rock Star').replace('Pikachu (Shaymin Scarf)', 'Pikachu Shaymin Scarf')
            .replace('Nidoran Male', 'Nidoranâ™‚').replace('Nidoran Female', 'Nidoranâ™€')
            .replace('(Alolan)', 'de Alola').replace('(Galarian)', 'de Galar')
            .replace('(Hisuian)', 'de Hisui').replace('(Paldean)', 'de Paldea')
            .replace('Tauros (Aqua)', 'Tauros de Paldea EspÃ©cie de Combate').replace('Tauros (Blaze)', 'Tauros de Paldea EspÃ©cie Labareda')
            .replace('Tauros (Combat)', 'Tauros de Paldea EspÃ©cie AquÃ¡tica').replace('Mewtwo (Armored)', 'Mewtwo de Armadura')
            .replace('Castform (Sunny)', 'Castform Emsolarada').replace('Castform (Rainy)', 'Castform Chuvosa')
            .replace('Castform (Snowy)', 'Castform Nevada').replace('Deoxys (Attack)', 'Deoxys Forma Ataque')
            .replace('Deoxys (Defense)', 'Deoxys Forma Defesa').replace('Deoxys (Speed)', 'Deoxys Forma Velocidade')
            .replace('Burmy (Plant)', 'Burmy Manto Vegetal').replace('Burmy (Sandy)', 'Burmy Manto Arenoso')
            .replace('Burmy (Trash)', 'Burmy Manto de Lixo').replace('Wormadam (Plant)', 'Wormadam Manto Vegetal')
            .replace('Wormadam (Sandy)', 'Wormadam Manto Arenoso').replace('Wormadam (Trash)', 'Wormadam Manto de Lixo');
    }

    // --- 3. CARREGAMENTO E PREPARAÃ‡ÃƒO DE DADOS ---
    async function carregarTodaABaseDeDados() {
        try {
            const responses = await Promise.all([
                fetch(URLS.MAIN_DATA).then(res => res.json()),
                fetch(URLS.MAIN_DATA_FALLBACK).then(res => res.json()),
                fetch(URLS.IMAGES_PRIMARY).then(res => res.json()),
                fetch(URLS.IMAGES_ALT).then(res => res.json()),
                fetch(URLS.TYPE_DATA).then(res => res.json())
            ]);
            const [mainData, fallbackData, primaryImages, altImages, typeData] = responses;
            const pokemonsMap = new Map(mainData.map(p => [p.speciesId, p]));
            fallbackData.forEach(p => { if (!pokemonsMap.has(p.speciesId)) pokemonsMap.set(p.speciesId, p); });

            return {
                pokemonsMap,
                mapaImagensPrimario: new Map(primaryImages.map(item => [item.nome, item])),
                mapaImagensAlternativo: new Map(altImages.map(item => [item.name, item])),
                dadosDosTipos: typeData
            };
        } catch (error) {
            console.error('âŒ Erro fatal ao carregar os arquivos JSON:', error);
            return null;
        }
    }

    // --- 4. LÃ“GICA CENTRAL DE BUSCA ---
    function buscarDadosCompletosPokemon(nomeOriginal, database) {
        const chaveDeBusca = nomeOriginal
            .replace(/Dinamax/i, '')
            .replace(/\*/g, '')
            .trim();

        let pokemonData = null;
        for (const p of database.pokemonsMap.values()) {
            if (p.speciesName.toLowerCase() === chaveDeBusca.toLowerCase()) {
                pokemonData = p;
                break;
            }
        }
        if (!pokemonData) return null;
        
        const nomeParaExibicao = formatarNomeParaExibicao(pokemonData.speciesName);
        let infoImagens = database.mapaImagensPrimario.get(nomeParaExibicao) || database.mapaImagensPrimario.get(pokemonData.speciesName);
        let imgNormal = infoImagens?.imgNormal;
        let imgShiny = infoImagens?.imgShiny;

        if (!imgNormal || !imgShiny) {
            const infoImagensAlt = database.mapaImagensAlternativo.get(pokemonData.speciesId);
            if(infoImagensAlt) {
                imgNormal = imgNormal || infoImagensAlt.imgNormal;
                imgShiny = imgShiny || infoImagensAlt.imgShiny;
            }
        }
        
        return { ...pokemonData, imgNormal, imgShiny, nomeParaExibicao };
    }


    // --- 5. PROCESSADORES DE LISTAS ---
    function processarListas(selector, tipoCard, database) {
        const listas = document.querySelectorAll(selector);
        const tabelaDeTipos = formatarTabelaTiposDetalhes(database.dadosDosTipos);
        listas.forEach(lista => {
            const itensOriginais = Array.from(lista.querySelectorAll('li'));
            lista.innerHTML = '';
            itensOriginais.forEach(item => {
                const nomeOriginal = item.textContent.trim();
                const pokemonCompleto = buscarDadosCompletosPokemon(nomeOriginal, database);
                if (pokemonCompleto) {
                    const geradorDeCard = {
                        'detalhes': generatePokemonListItemDetalhes,
                        'reide': generatePokemonListItemReide,
                        'selvagem': criarElementoPokemonSelvagem
                    }[tipoCard];
                    const novoItem = geradorDeCard(pokemonCompleto, nomeOriginal, tabelaDeTipos);
                    lista.appendChild(novoItem);
                } else {
                    console.warn(`PokÃ©mon "${nomeOriginal}" nÃ£o encontrado.`);
                }
            });
        });
        iniciarAlternanciaImagens(selector + ' li', database);
    }
    
    // --- 6. GERADORES DE CARDS HTML ---
    function criarElementoPokemonSelvagem(pokemon, nomeOriginal) {
        const li = document.createElement('li');
        li.dataset.nomeOriginal = nomeOriginal;
        const validTipos = pokemon.types.filter(t => t && t.toLowerCase() !== 'none');
        const [tipo1, tipo2] = validTipos;
        li.className = `Selvagem ${tipo1}`;
        if (tipo2) li.classList.add(tipo2);
        if (tipo2) li.style.background = `linear-gradient(to right, ${getTypeColor(tipo1)}, ${getTypeColor(tipo2)})`;
        else if(tipo1) li.style.backgroundColor = getTypeColor(tipo1);
        const isShadow = /\(shadow\)/i.test(pokemon.speciesName);
        li.innerHTML = `
            <div class="pokemon-image-container ${isShadow ? 'is-shadow' : ''}">
                <img class="imgSelvagem" src="${pokemon.imgNormal}" alt="${pokemon.nomeParaExibicao}">
            </div>
            <span>${nomeOriginal}</span>
        `;
        return li;
    }
    
    // --- CORREÃ‡ÃƒO REIDE-LIST --- FunÃ§Ã£o revisada para incluir todas as seÃ§Ãµes e correÃ§Ãµes.
    function generatePokemonListItemReide(pokemon, nomeOriginal) {
        const li = document.createElement('li');
        li.dataset.nomeOriginal = nomeOriginal;
        li.className = 'PokemonReideItem';
        
        const validTipos = pokemon.types.filter(t => t && t.toLowerCase() !== 'none');
        validTipos.forEach(t => li.classList.add(t.toLowerCase()));
        
        if (validTipos.length > 1) {
            li.style.background = `linear-gradient(to right, ${getTypeColor(validTipos[0])}, ${getTypeColor(validTipos[1])})`;
        } else if (validTipos.length === 1) {
            li.style.backgroundColor = getTypeColor(validTipos[0]);
        }
        
        const isShadow = /\(shadow\)/i.test(pokemon.speciesName);
        const isDynamax = /Dinamax/i.test(nomeOriginal);
        const minIVs = isShadow ? { atk: 6, def: 6, hp: 6 } : { atk: 10, def: 10, hp: 10 };
        const cpInfo = { normal: calculateCP(pokemon.baseStats, minIVs, 20), perfect: calculateCP(pokemon.baseStats, { atk: 15, def: 15, hp: 15 }, 20) };
        const cpBoost = { normal: calculateCP(pokemon.baseStats, minIVs, 25), perfect: calculateCP(pokemon.baseStats, { atk: 15, def: 15, hp: 15 }, 25) };
        const weatherIcons = [...new Set(validTipos.map(tipo => getWeatherIcon(tipo)))].map(icon => icon ? `<img class="clima-boost" src="${icon}">` : '').join('');

        li.innerHTML = `
            <div class="pokemon-image-container ${isShadow ? 'is-shadow' : ''} ${isDynamax ? 'is-dynamax' : ''}">
                <img class="pokemon-reide-img" src="${pokemon.imgNormal}" alt="${pokemon.nomeParaExibicao}">
            </div>
            <span>${nomeOriginal}</span>
            <div class="tipo-icons">${validTipos.map(tipo => `<img src="${getTypeIcon(tipo)}" alt="${TYPE_TRANSLATION_MAP[tipo] || tipo}">`).join('')}</div>
            <div class="pc-info">PC: ${cpInfo.normal} - ${cpInfo.perfect}</div>
            <div class="boost">
                ${weatherIcons}
                <div class="pc-boost"> ${cpBoost.normal} - ${cpBoost.perfect}</div>
            </div>`;
        return li;
    }
    
    function generatePokemonListItemDetalhes(pokemon, nomeOriginal, tabelaDeTipos) {
        const li = document.createElement('li');
        li.dataset.nomeOriginal = nomeOriginal;
        li.className = 'ItemDetalhes';
        const validTipos = pokemon.types.filter(t => t && t.toLowerCase() !== 'none');
        validTipos.forEach(t => li.classList.add(t.toLowerCase()));
        if (validTipos.length > 1) {
            li.style.background = `linear-gradient(to right, ${getTypeColor(validTipos[0])}, ${getTypeColor(validTipos[1])})`;
        } else if (validTipos.length === 1) {
            li.style.backgroundColor = getTypeColor(validTipos[0]);
        }
        const isShadow = /\(shadow\)/i.test(pokemon.speciesName);
        const isDynamax = /Dinamax/i.test(nomeOriginal);
        const minIVs = isShadow ? { atk: 6, def: 6, hp: 6 } : { atk: 10, def: 10, hp: 10 };
        const cpInfo = { normal: calculateCP(pokemon.baseStats, minIVs, 20), perfect: calculateCP(pokemon.baseStats, { atk: 15, def: 15, hp: 15 }, 20) };
        const cpBoost = { normal: calculateCP(pokemon.baseStats, minIVs, 25), perfect: calculateCP(pokemon.baseStats, { atk: 15, def: 15, hp: 15 }, 25) };
        const weatherIcons = [...new Set(validTipos.map(tipo => getWeatherIcon(tipo)))].map(icon => icon ? `<img class="clima-boost" src="${icon}">` : '').join('');
        const fraquezas = calcularFraquezasDetalhes(validTipos, tabelaDeTipos);
        const fraquezasHTML = Object.keys(fraquezas).length > 0 ? `
            <div class="detalhes-weakness-section">
                <h4>FRAQUEZAS</h4>
                <ul class="detalhes-weakness-list">
                    ${Object.entries(fraquezas).sort(([,a],[,b]) => b-a).map(([tipo, mult]) => `
                        <li class="detalhes-weakness-item">
                            <div class="detalhes-weakness-type">
                                <img src="${getTypeIcon(tipo)}" alt="${tipo}">
                                <span>${tipo}</span>
                            </div>
                            <span class="detalhes-weakness-percentage">${Math.round(mult * 100)}%</span>
                        </li>`).join('')}
                </ul>
            </div>` : '';
        li.innerHTML = `
            <div class="pokemon-image-container ${isShadow ? 'is-shadow' : ''} ${isDynamax ? 'is-dynamax' : ''}">
                <img class="img-detalhes" src="${pokemon.imgNormal}" alt="${pokemon.nomeParaExibicao}">
            </div>
            <span>${nomeOriginal}</span>
            <div class="tipo-icons">${validTipos.map(tipo => `<img src="${getTypeIcon(tipo)}" alt="${TYPE_TRANSLATION_MAP[tipo] || tipo}">`).join('')}</div>
            <div class="pc-info">PC: ${cpInfo.normal} - ${cpInfo.perfect}</div>
            <div class="boost">
                ${weatherIcons}
                <div class="pc-boost"> ${cpBoost.normal} - ${cpBoost.perfect}</div>
            </div>
            ${fraquezasHTML}
        `;
        return li;
    }
    
    // --- 7. LÃ“GICA DE ALTERNÃ‚NCIA SHINY E FRAQUEZAS ---
    function iniciarAlternanciaImagens(selector, database) {
        document.querySelectorAll(selector).forEach(item => {
            const nomeOriginal = item.dataset.nomeOriginal;
            if (!nomeOriginal || !nomeOriginal.includes('*')) return;
            const img = item.querySelector('img');
            const pokemonCompleto = buscarDadosCompletosPokemon(nomeOriginal, database);
            if (img && pokemonCompleto?.imgNormal && pokemonCompleto?.imgShiny) {
                let showShiny = false;
                setInterval(() => {
                    img.style.transition = 'opacity 0.5s';
                    img.style.opacity = 0;
                    setTimeout(() => {
                        img.src = showShiny ? pokemonCompleto.imgShiny : pokemonCompleto.imgNormal;
                        img.style.opacity = 1;
                        showShiny = !showShiny;
                    }, 500);
                }, 2500);
            }
        });
    }
    
    function formatarTabelaTiposDetalhes(dadosDefensivos) {
        const tabelaOfensiva = {};
        dadosDefensivos.forEach(t => { tabelaOfensiva[t.tipo] = { ataca: {} }; });
        dadosDefensivos.forEach(info => {
            const defensor = info.tipo;
            for (const mult in info.defesa.fraqueza) { info.defesa.fraqueza[mult].forEach(atacante => { tabelaOfensiva[atacante].ataca[defensor] = parseFloat(mult); }); }
            for (const mult in info.defesa.resistencia) { info.defesa.resistencia[mult].forEach(atacante => { tabelaOfensiva[atacante].ataca[defensor] = parseFloat(mult); }); }
            if (info.defesa.imunidade) { info.defesa.imunidade.forEach(atacante => { tabelaOfensiva[atacante].ataca[defensor] = 0; }); }
        });
        return tabelaOfensiva;
    }

    function calcularFraquezasDetalhes(tiposDoPokemon, tabelaDeTipos) {
        const fraquezas = {};
        if (!tabelaDeTipos || Object.keys(tabelaDeTipos).length === 0) return fraquezas;
        Object.keys(tabelaDeTipos).forEach(tipoAtacante => {
            let multiplicadorFinal = 1;
            tiposDoPokemon.forEach(tipoDefensorIngles => {
                const tipoDefensorPortugues = TYPE_TRANSLATION_MAP[tipoDefensorIngles.toLowerCase()];
                if (tipoDefensorPortugues) {
                    const interacao = tabelaDeTipos[tipoAtacante]?.ataca?.[tipoDefensorPortugues];
                    if (interacao !== undefined) multiplicadorFinal *= interacao;
                }
            });
            if (multiplicadorFinal > 1) {
                const tipoCapitalizado = tipoAtacante.charAt(0).toUpperCase() + tipoAtacante.slice(1);
                fraquezas[tipoCapitalizado] = multiplicadorFinal;
            }
        });
        return fraquezas;
    }

    // --- 8. PONTO DE ENTRADA PRINCIPAL ---
    async function main() {
        console.log("ðŸš€ Iniciando processamento com a nova base de dados...");
        const database = await carregarTodaABaseDeDados();
        if (!database) {
            console.error("Falha ao preparar a base de dados. Abortando.");
            return;
        }
        processarListas('.pokemon-list', 'selvagem', database);
        processarListas('.reide-list', 'reide', database);
        processarListas('.lista-detalhes', 'detalhes', database);
        console.log("âœ… Processamento concluÃ­do.");
    }

    window.addEventListener('load', main);
    </script>
</body>
</html>